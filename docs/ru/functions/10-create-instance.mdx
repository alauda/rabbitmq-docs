---
weight: 10
sourceSHA: e4cf4b949972b5cbad48e07ffe7802ba3f594560fc4d4a670a0853657e50938e
---

# Создание экземпляра

RabbitMQ - это популярное программное обеспечение для обмена сообщениями, которое имеет эффективный и надежный механизм асинхронной доставки сообщений. Он в основном используется для обмена данными и передачи информации между различными системами и имеет широкий спектр применения в таких областях, как корпоративные решения, финансовые платежи, телекоммуникации, электронная коммерция, социальные сети, мгновенные сообщения, видео, Интернет вещей и сетевые технологии.

В текущей версии поддерживаются следующие версии RabbitMQ: `3.8.16` и `3.12`. При создании экземпляра можно выбрать только эти две версии. Процесс создания экземпляра будет использовать `3.12` в качестве примера.

<Directive type="tip" title="Рекомендация по версии">
  При выборе версии рекомендуется выбирать последнюю поддерживаемую версию. У `3.12` есть следующие преимущества:

  1. `3.12` поддерживает очереди с кворумом, готовыми к производству; кроме того, сообщество устранило множество ошибок, а производительность значительно улучшилась в `3.12`.
  2. `3.8.x` будет постепенно выводиться из эксплуатации. Если вы в данный момент используете серию `3.8.x` и позже потребуется обновление версии, это может повлиять на бизнес-процессы.
</Directive>

## Создание экземпляра RabbitMQ

### Необходимые предварительные условия

- Пожалуйста, убедитесь, что в текущем кластере есть доступный класс хранения и достаточно свободного места.

### Процедура

<Tabs>
  <Tab label="CLI">
    Создайте экземпляр RabbitMQ через CLI:

    ```bash
    $ cat << EOF | kubectl -n default create -f -
    apiVersion: rabbitmq.com/v1beta1
    kind: RabbitmqCluster
    metadata:
      name: rrrr
    spec:
      affinity:
        podAntiAffinity:
          requiredDuringSchedulingIgnoredDuringExecution:
            - labelSelector:
                matchLabels:
                  app.kubernetes.io/name: cluster-in
              topologyKey: kubernetes.io/hostname
      persistence:
        storage: 1Gi
        storageClassName: sc-topolvm
      rabbitmq:
        additionalConfig: |-
          channel_max=1000
          cluster_keepalive_interval=10000
          collect_statistics=none
          collect_statistics_interval=5000
          default_vhost=/
          delegate_count=16
          disk_free_limit.absolute=50MB
          handshake_timeout=10000
          heartbeat=60
          max_message_size=134217728
          mirroring_sync_batch_size=4096
          mnesia_table_loading_retry_limit=10
          mnesia_table_loading_retry_timeout=30000
          num_acceptors.tcp=10
          queue_index_embed_msgs_below=4096
          raft.wal_max_size_bytes=64000000
          vm_memory_calculation_strategy=allocated
          vm_memory_high_watermark.relative=0.4
          vm_memory_high_watermark_paging_ratio=0.5
      replicas: 3
      resources:
        limits:
          cpu: 1
          memory: 2Gi
        requests:
          cpu: 1
          memory: 2Gi
      service:
        type: ClusterIP
      upgradeOption:
        autoUpgrade: false
      version: "3.12"
    EOF
    ```

    > Для получения детальной информации о полях, пожалуйста, обратитесь к [Документации RabbitMQ API](../apis/kubernetes_apis/rabbitmq/rabbitmq).

    После создания экземпляра вы можете просмотреть экземпляр с помощью следующей команды:

    ```bash
    $ kubectl -n default get rabbitmqclusters
    NAME   AGE
    rrrr   74s
    ```

    Вы можете использовать следующую пользовательскую команду для массового просмотра статуса экземпляров:

    ```bash
    $ kubectl -n default get rabbitmqclusters rrrr -o custom-columns='NAME:.metadata.name,PHASE:.status.phase,USER SECRET:.status.defaultUser.secretReference.name'
    NAME   PHASE    USER SECRET
    rrrr   Active   rrrr-default-user
    ```

    Значение полей выходной таблицы следующее:

    | Поле        | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
    | :---------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
    | NAME        | Имя экземпляра                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
    | PHASE       | Статус экземпляра, который может находиться в следующих состояниях: <ul><li>`Создание`: Экземпляр создает ресурсы и инициализирует кластер</li><li>`Обновление`: Конфигурация экземпляра обновляется</li><li>`Активный`: Экземпляр находится в рабочем состоянии</li><li>`Ошибка`: Экземпляр столкнулся с ошибкой во время инициализации или обновления</li><li>`Неизвестно`: Экземпляр находится в нераспознанном состоянии</li><li>`Приостановлен`: Экземпляр приостановлен, и связанные Pods были выключены</li></ul> |
    | USER SECRET | Секрет, который хранит информацию о учетной записи по умолчанию                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
  </Tab>

  <Tab label="Веб-консоль">
    1. В левой навигационной панели нажмите **RabbitMQ**.

    2. Нажмите на ***имя пространства имен***.

    3. Нажмите **Создать экземпляр RabbitMQ**.

    4. Ознакомьтесь с дальнейшими инструкциями для настройки соответствующих параметров.

    <table>
      <tr>
        <th nowrap>Конфигурация</th>
        <th>Параметр</th>
        <th>Описание</th>
      </tr>

      <tr>
        <td><b>Конфигурация параметров</b></td>
        <td><b>Шаблон параметров</b></td>
        <td>Вы можете выбрать системный или пользовательский шаблон параметров; для пользовательских шаблонов, пожалуйста, обратитесь к <a href="">Шаблонам параметров</a>.</td>
      </tr>

      <tr>
        <td nowrap><b>Конфигурация ресурсов</b></td>
        <td><b>Класс хранения</b></td>
        <td>Если в выпадающем списке не найдено доступного класса хранения, пожалуйста, свяжитесь с <b>администратором платформы</b>, чтобы добавить один.</td>
      </tr>

      <tr>
        <td nowrap><b>Конфигурация подключения</b></td>
        <td><b>Указать порт хоста</b></td>
        <td>Этот вариант конфигурации появляется при выборе доступа из внешнего кластера.<br /><b>Примечание</b>: при обновлении экземпляра порт не поддерживает замену. Если вам нужно заменить порты, сначала вы можете обновить на другой неиспользуемый порт, а затем снова указать.</td>
      </tr>

      <tr>
        <td rowspan="2"><b>Конфигурация расписания</b></td>
        <td><b>Метки узлов</b></td>
        <td>Это фильтрует доступные узлы в текущем кластере по меткам. Pods будут запланированы на доступные узлы.<br /><b>Примечание</b>: после создания экземпляра данная конфигурация больше не подлежит изменению.</td>
      </tr>

      <tr>
        <td><b>Tolerations Pods</b></td>
        <td>Если доступные узлы были помечены, только Pods с tolerations будут терпимы к этим меткам и могут быть запланированы на узлы, соответствующие tolerations Pods и меткам узлов. Правила сопоставления следующие: <ul><li><b>Равно</b>: когда <i>ключ</i>, <i>значение</i> и <i>эффект</i> toleration Pods точно совпадают с соответствующими значениями в метке узла, Pod будет терпим к метке узла.</li><li><b>Существует</b>: когда <i>ключ</i> и <i>эффект</i> toleration Pods совпадают с соответствующими значениями в метке узла, Pod будет терпим к метке узла.</li></ul><b>Описание</b>: эффект определяет, будут ли Pods, которые не терпят метки узлов, назначены на узлы с метками. Например, если эффект NoExecute, только Pods, терпящие метки, могут быть запланированы, а Pods, уже работающие на узле, которые не терпят метки, будут выселены. Для получения дополнительной информации о правилах сопоставления обратитесь к <a href="https://kubernetes.io/zh-cn/docs/concepts/scheduling-eviction/taint-and-toleration/">Официальной документации Kubernetes</a>.</td>
      </tr>
    </table>

    5. Нажмите **Создать**. Дождитесь изменения статуса экземпляра на **Запущен**, что указывает на то, что экземпляр был успешно создан.

    6. Приступите к доставке сообщений.
  </Tab>
</Tabs>

<Directive type="info" title="Совет">
  Для методов подключения бизнес-приложений к экземплярам RabbitMQ, пожалуйста, обратитесь к [Выбор адреса подключения и настройка способа подключения](../how_to/10-access).
</Directive>
