---
weight: 10
---

# 客户端访问

业务应用访问 RabbitMQ 实例时有多种连接方式，本节描述了 `Java`,`Python` 如何访问 RabbitMQ 实例。

## 适用场景

| 访问方式   | 适用场景                                                                             |
| ---------- | ------------------------------------------------------------------------------------ |
| **集群内访问** | 集群内应用通过 SVC 暴露的端口访问 RabbitMQ 实例。                                    |
| **集群外访问** | 集群外应用通过 NodePort 的端口访问 RabbitMQ 实例。<br/>通过相应实例端口访问管理门户。|

## 连接 RabbitMQ

前提条件

1. 参考[访问方式](../functions/40-accessmethod) 获取到指定的访问地址。
2. 参考[用户管理](../functions/20-user) 获取到实例的用户名和密码信息。

<Directive type="tip" title="提示">
注意替换代码中的 `<username>`, `<password>` 为具体的实例账户信息。

注意替换代码中的 `<ip>`，`<port>` 为具体的实例访问地址。对集群外访问方式，可能存在多个访问地址，可都填写上，以提高连接的可靠性。
</Directive>

<Tabs>

<Tab label="Java 客户端示例">

Java 访问示例如下:

```java
import com.rabbitmq.client.*;

import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.util.concurrent.TimeoutException;
import java.util.HashMap;
import java.util.UUID;
    
public class ProducerTest {
    public static void main(String[] args) throws Exception {
        Address[] addresses = {
            new Address(<ip 1>,<port 1>),
            new Address(<ip 2>,<port 2>),
            new Address(<ip 3>,<port 3>)
        };
        String username = "<username>";
        String password = "<password>";
        String vhostName = "/";
        String exchangeName = "testExchange";
        String exchangeType = "direct";
        String queueName = "test";

        ConnectionFactory factory = new ConnectionFactory();

        factory.setUsername(username);

        factory.setPassword(password);

        factory.setAutomaticRecoveryEnabled(true);
        factory.setNetworkRecoveryInterval(5000);

        factory.setVirtualHost(vhostName);

        factory.setConnectionTimeout(30 * 1000);
        factory.setHandshakeTimeout(30 * 1000);
        factory.setShutdownTimeout(0);
        
        Connection connection = factory.newConnection(addresses);
        Channel channel = connection.createChannel();
        channel.exchangeDeclare(exchangeName, exchangeType, true, false, false, null);
        channel.queueDeclare(queueName, true, false, false, new HashMap<String, Object>());
        channel.queueBind(queueName, exchangeName, "BindingKeyTest");

        for (int i = 0; i < 100; i++  ) {
                String message = "Hello World!"+ i;
                channel.basicPublish(exchangeName, "BindingKeyTest", MessageProperties.PERSISTENT_TEXT_PLAIN, message.getBytes());
                System.out.println(" [x] Sent '" + message + "'");
        }
        channel.close();
        connection.close();
    }
}
```

更多关于 Java 客户端的示例，可参考 [Java Client API Guide](https://www.rabbitmq.com/client-libraries/java-api-guide) 。

</Tab>

<Tab label="Python 客户端示例">

Python 访问示例如下：

```go
import pika
import random

def on_message(channel, method_frame, header_frame, body):
    print(method_frame.delivery_tag)
    print(body)
    print()
    channel.basic_ack(delivery_tag=method_frame.delivery_tag)

credentials = pika.PlainCredentials('<username>','<password>')
node1 = pika.ConnectionParameters(<ip 1>, <port 1>, '/', credentials)
node2 = pika.ConnectionParameters(<ip 2>, <port 2>, '/', credentials)
node3 = pika.ConnectionParameters(<ip 3>, <port 3>, '/', credentials)
all_endpoints = [node1,node2,node3]

while(True):
    try:
        print("Connecting...")

        random.shuffle(all_endpoints)
        connection = pika.BlockingConnection(all_endpoints)
        channel = connection.channel()
        channel.basic_qos(prefetch_count=1)

        channel.queue_declare('recovery-example', durable = False, auto_delete = True)
        channel.basic_consume('recovery-example', on_message)
        try:
            channel.start_consuming()
        except KeyboardInterrupt:
            channel.stop_consuming()
            connection.close()
            break
    except pika.exceptions.ConnectionClosedByBroker:
        continue

    except pika.exceptions.AMQPChannelError as err:
        print("Caught a channel error: {}, stopping...".format(err))
        break

    except pika.exceptions.AMQPConnectionError:
        print("Connection was closed, retrying...")
        continue
```

更多关于 `pika` 的示例，可参考 [pika 的 GitHub 仓库](https://github.com/pika/pika/tree/main/examples) 。

</Tab>
</Tabs>

关于其他客户端的使用，请参考[RabbitMQ Tutorials](https://www.rabbitmq.com/tutorials)。
